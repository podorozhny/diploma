require.config();

requirejs(['jquery', 'components/test'], function ($, lol) {
    console.log(lol ? 'application is working!' : 'application is not working!');

    let coordinates = [
        [55.77258, 37.67906], [55.772954, 37.678968], [55.77298, 37.678975],
        [55.773903, 37.681157], [55.774499, 37.683178], [55.774663, 37.683644],
        [55.773527, 37.685078], [55.773242, 37.686713], [55.773187, 37.686871],
        [55.770773, 37.689944], [55.769655, 37.691912], [55.76872, 37.690116],
        [55.767272, 37.687681], [55.766835, 37.687417], [55.763953, 37.685117],
        [55.761614, 37.684467], [55.761101, 37.684341], [55.760857, 37.684203],
        [55.760085, 37.683274], [55.75981, 37.682683], [55.759693, 37.682362],
        [55.759272, 37.680385], [55.759258, 37.679919], [55.759283, 37.677607],
        [55.759398, 37.672231], [55.759255, 37.671749], [55.759092, 37.671358],
        [55.757308, 37.669369], [55.757199, 37.669345], [55.757115, 37.669349],
        [55.755121, 37.670806], [55.75488, 37.671197], [55.75439, 37.672117],
        [55.753605, 37.67269], [55.753441, 37.672698], [55.753216, 37.672675],
        [55.752154, 37.671814], [55.751284, 37.670479], [55.751077, 37.670198],
        [55.749451, 37.667965], [55.749022, 37.667488], [55.748639, 37.666984],
        [55.748301, 37.6661], [55.748289, 37.665911], [55.748309, 37.665599],
        [55.749463, 37.663827], [55.749736, 37.663472], [55.749941, 37.663119],
        [55.750369, 37.661702], [55.750519, 37.659969], [55.750638, 37.658839],
        [55.750385, 37.655996], [55.75017, 37.65491], [55.749979, 37.653657],
        [55.748325, 37.641389], [55.748243, 37.641161], [55.748019, 37.640755],
        [55.749209, 37.634363], [55.749439, 37.633452], [55.749611, 37.63249],
        [55.749936, 37.627144], [55.749891, 37.625918], [55.749833, 37.625044],
        [55.749339, 37.620674], [55.748838, 37.617266], [55.748678, 37.616447],
        [55.747312, 37.611127], [55.747157, 37.610814], [55.74695, 37.61048],
        [55.743854, 37.607433], [55.743605, 37.607239], [55.74342, 37.607122],
        [55.742787, 37.60684], [55.742763, 37.606785], [55.742746, 37.606667],
        [55.744619, 37.602803], [55.744712, 37.602694], [55.744354, 37.602148],
        [55.739987, 37.596599], [55.739836, 37.596437], [55.738426, 37.595559],
        [55.736843, 37.594901], [55.736141, 37.594602], [55.73554, 37.594304],
        [55.732302, 37.592253], [55.732016, 37.592037], [55.731819, 37.591837],
        [55.731632, 37.590869], [55.732476, 37.589061], [55.73258, 37.588865],
    ];

    ymaps.ready(() => {
        let $mapElement   = $('#map'),
            centerAndZoom = ymaps.util.bounds.getCenterAndZoom(
                [[55.7, 37.6], [55.8, 37.7]],
                [$mapElement.width(), $mapElement.height()]
            );

        let map = new ymaps.Map($mapElement[0], {
            center:    centerAndZoom.center,
            zoom:      centerAndZoom.zoom,
            behaviors: [
                'default',
                'scrollZoom',
            ],
            controls:  [
                'fullscreenControl',
                'rulerControl',
                'typeSelector',
                'zoomControl',
            ],
        }, {
            suppressMapOpenBlock:            true,
            suppressObsoleteBrowserNotifier: true,
        });

        map.copyrights.add('&copy; Ivan Podorozhny');

        map.geoObjects.add(new ymaps.Polyline(
            coordinates,
            {
                hintContent: 'Ломаная линия'
            },
            {
                strokeColor:   '#ff0000',
                strokeOpacity: 0.5,
                strokeWidth:   4
            }
        ));

        $.each(coordinates, function (index, coordinate) {
            map.geoObjects.add(new ymaps.Placemark(coordinate, {}, {
                iconLayout:      'default#image',
                iconImageHref:   '/img/dot.svg',
                iconImageSize:   [4, 4],
                iconImageOffset: [-2, -2]
            }));
        });
    });
});
